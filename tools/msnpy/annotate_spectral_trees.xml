<tool id="msnpy_annotate_spectral_trees" name="MSnPy Annotate Spectral Trees" version="@TOOL_VERSION@+galaxy@GALAXY_TOOL_VERSION@">
    <description> - Annotate and/or filter spectral trees.</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <stdio>
        <exit_code level="fatal" range="1:"/>
    </stdio>
    <version_command>python msnpy annotate-spectral-trees --version</version_command>
    <command>
    <![CDATA[
        msnpy annotate-spectral-trees
        #if $input and $input is not None:
            --input $input
        #end if

        #if $ppm and $ppm is not None:
            --ppm $ppm
        #end if
        $rules

        #if $mf_db and $mf_db is not None:
            --mf-db $mf_db
        #end if

        --output-db $annotation_db
        --output-trees $output_trees

        #if $adducts_cond.adducts_input_type == 'adducts_choose'
            --adducts $adducts_cond.adducts_choose
        #else
           --adducts $adducts_cond.adducts_manual
        #endif
        $filter
    ]]>
    </command>
    <inputs>
        <param type="data" format="json" label="Spectra trees" help="Json file containing spectral trees" name="input">
            <validator type="empty_field" />
        </param>
        <param argument="--ppm" label="Mass tolerance in Parts per million." name="ppm" optional="true" type="float" value="2.0"/>
        <param argument="--rules" checked="false" label="" name="rules" type="boolean" truevalue="--rules" falsevalue=""/>
        <param argument="--mf-db" label="Molecular formulae database" name="mf_db" optional="true" type="text"
               value="https://mfdb.bham.ac.uk"/>
        <param argument="--filter" checked="true" label="Filter the spectral tree annotations"
               name="filter" type="boolean" truevalue="--filter" falsevalue=""/>
        <conditional name="adducts_cond">
            <param argument="adducts_input_type" type="select" help="" >
                <option value="adducts_choose" selected="true" >Choose from list of pre-calculated adducts and masses</option>
                <option value="adducts_manual" >Manually enter the list of adducts and masses to use</option>
            </param>
            <when value="adducts_choose">
                <param argument="--adducts_choose" type="select" multiple="true" help="" >
                    <option value="[M+H]+_1.0072764" selected="true" >[M+H]+</option>
                    <option value="[M+NH4]+_18.0338254" selected="true" >[M+NH4]+</option>
                    <option value="[M+Na]+_22.9892214" selected="true" >[M+Na]+</option>
                    <option value="[M+(39K)]+_38.963159399999995">[M+(39K)]+</option>
                    <option value="[M+(39K)]+_40.961276399999996">[M+(41K))]+</option>
                    <option value="[M+(6Li)]+_6.0145744">[M+(6Li)]+</option>
                    <option value="[M+(7Li)]+_7.0154564">[M+(7Li)]+</option>
                    <option value="[NaCl][M+H]+_58.9658994">[NaCl][M+H]+</option>
                    <option value="[M+H+HCOOH]+_47.01274598">[M+H+HCOOH]+</option>
                    <option value="[M+H+NaCl]+_58.96589686">[M+H+NaCl]+</option>
                    <option value="[M+NH4+HCOOH]+_64.03929298">[M+NH4+HCOOH]+</option>
                    <option value="[M+Na+HCOOH]+_68.99468798">[M+Na+HCOOH]+</option>
                    <option value="[M+H+CHOONa]+_68.99471998">[M+H+CHOONa]+</option>
                    <option value="[M+H+KCl]+_74.93983656">[M+H+KCl]+</option>
                    <option value="[M+K+HCOOH]+_84.96862798">[M+K+HCOOH]+</option>
                    <option value="[M-H]-_-1.0072764">[M-H]-</option>
                    <option value="[M+(35Cl)]-_34.969401600000005">[M+(35Cl)]-</option>
                    <option value="[M+(37Cl)]-_36.9664516">[M+(37Cl)]-</option>
                    <option value="[M+Na-2H]-_20.974668599999998" >[M+Na-2H]-</option>
                    <option value="[M+K-2H]-_36.9486066">[M+K-2H]-</option>
                    <option value="[M+Hac-H]-_59.0138536">[M+Hac-H]-</option>
                    <option value="NA_0.0">NA</option>
                </param>
            </when>
            <when value="adducts_manual">
                <param argument="--adducts_manual" type="text" value=""
                       help="Adducts and the mass difference separated by an underscore e.g.
                             [M+H]+_1.0072764 [M+NH4]+_18.0338254 [M+Na]+_22.9892214 " />
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data format="json" hidden="false" name="output_trees" label="${tool.name} on ${on_string}: Spectral trees (json)"/>
        <data format="sqlite" hidden="false" name="annotation_db" label="${tool.name} on ${on_string}: Annotation db (sqlite)"/>
    </outputs>
    <tests>
        <test>
            <param name="input" value="A08_spectral_trees.json" ftype="json"/>
            <output name="output_trees" value="A08_annotated_trees.json"/>
            <output name="annotation_db" value="A08_mf_annotation_db.sqlite"/>
        </test>
    </tests>

    <help>
Annotate and filter spectral trees
==========================================================================

Description
----------------

    </help>
    <expand macro="citations" />
</tool>
